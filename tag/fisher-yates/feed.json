{
    "version": "https://jsonfeed.org/version/1",
    "title": "QWERTY • All posts by \"fisher-yates\" tag",
    "description": "Programming | Computer Science | Thought",
    "home_page_url": "http://gitqwerty777.github.io",
    "items": [
        {
            "id": "http://gitqwerty777.github.io/why-linear-shuffle-works/",
            "url": "http://gitqwerty777.github.io/why-linear-shuffle-works/",
            "title": "隨機排序演算法實作",
            "date_published": "2022-01-15T10:12:50.000Z",
            "content_html": "<h2 id=\"簡介\"><a href=\"#簡介\" class=\"headerlink\" title=\"簡介\"></a>簡介</h2><p>說到隨機排序(shuffle)演算法，最著名的肯定是Fisher–Yates，它是一個$O(N)$時間的演算法，偽碼如下</p>\n<a id=\"more\"></a>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"constructor\">Shuffle(Array <span class=\"params\">a</span>)</span>&#123;</span><br><span class=\"line\">    N = a.length</span><br><span class=\"line\">    for (i = <span class=\"number\">0</span> ~ N-<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">        <span class=\"constructor\">Swap(<span class=\"params\">a</span>[<span class=\"params\">i</span>], <span class=\"params\">a</span>[Random <span class=\"params\">value</span> <span class=\"params\">between</span> <span class=\"params\">i</span> <span class=\"params\">and</span> N])</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>簡單來說就是每個元素都和之後(包含自身)的隨機一個元素交換</p>\n<h2 id=\"實作\"><a href=\"#實作\" class=\"headerlink\" title=\"實作\"></a>實作</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\"></span><br><span class=\"line\">N = <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">Shuffle</span><span class=\"params\">(arr)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(N<span class=\"number\">-1</span>):</span><br><span class=\"line\">        j = random.randint(i, N<span class=\"number\">-1</span>)</span><br><span class=\"line\">        arr[i], arr[j] = arr[j], arr[i]</span><br><span class=\"line\"></span><br><span class=\"line\">total = [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(N)] <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> range(N)]</span><br><span class=\"line\"><span class=\"keyword\">for</span> t <span class=\"keyword\">in</span> range(<span class=\"number\">1000000</span>):</span><br><span class=\"line\">    arr = [i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(N)]</span><br><span class=\"line\">    Shuffle(arr)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i, v <span class=\"keyword\">in</span> enumerate(arr):</span><br><span class=\"line\">        total[v][i] += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(N):</span><br><span class=\"line\">    print(<span class=\"string\">f\"數字<span class=\"subst\">&#123;i&#125;</span>分佈\"</span>)</span><br><span class=\"line\">    print(<span class=\"string\">\",\"</span>.join(str(v) <span class=\"keyword\">for</span> v <span class=\"keyword\">in</span> total[i]))</span><br></pre></td></tr></table></figure>\n\n<p>執行1000000次Shuffle，各數字的分布</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"code\"><pre><span class=\"line\">數字<span class=\"number\">0</span>分佈</span><br><span class=\"line\"><span class=\"number\">99656</span>,<span class=\"number\">99624</span>,<span class=\"number\">100636</span>,<span class=\"number\">100081</span>,<span class=\"number\">99957</span>,<span class=\"number\">100149</span>,<span class=\"number\">100238</span>,<span class=\"number\">100287</span>,<span class=\"number\">99710</span>,<span class=\"number\">99662</span></span><br><span class=\"line\">數字<span class=\"number\">1</span>分佈</span><br><span class=\"line\"><span class=\"number\">100043</span>,<span class=\"number\">100292</span>,<span class=\"number\">99499</span>,<span class=\"number\">100262</span>,<span class=\"number\">100141</span>,<span class=\"number\">99847</span>,<span class=\"number\">100098</span>,<span class=\"number\">100164</span>,<span class=\"number\">99655</span>,<span class=\"number\">99999</span></span><br><span class=\"line\">數字<span class=\"number\">2</span>分佈</span><br><span class=\"line\"><span class=\"number\">100032</span>,<span class=\"number\">100412</span>,<span class=\"number\">99857</span>,<span class=\"number\">100035</span>,<span class=\"number\">100148</span>,<span class=\"number\">99738</span>,<span class=\"number\">100139</span>,<span class=\"number\">99765</span>,<span class=\"number\">99681</span>,<span class=\"number\">100193</span></span><br><span class=\"line\">數字<span class=\"number\">3</span>分佈</span><br><span class=\"line\"><span class=\"number\">100031</span>,<span class=\"number\">99868</span>,<span class=\"number\">100572</span>,<span class=\"number\">99418</span>,<span class=\"number\">99965</span>,<span class=\"number\">99918</span>,<span class=\"number\">99889</span>,<span class=\"number\">100107</span>,<span class=\"number\">100279</span>,<span class=\"number\">99953</span></span><br><span class=\"line\">數字<span class=\"number\">4</span>分佈</span><br><span class=\"line\"><span class=\"number\">100214</span>,<span class=\"number\">99716</span>,<span class=\"number\">100181</span>,<span class=\"number\">100315</span>,<span class=\"number\">99764</span>,<span class=\"number\">99667</span>,<span class=\"number\">100270</span>,<span class=\"number\">99829</span>,<span class=\"number\">99871</span>,<span class=\"number\">100173</span></span><br><span class=\"line\">數字<span class=\"number\">5</span>分佈</span><br><span class=\"line\"><span class=\"number\">99952</span>,<span class=\"number\">100282</span>,<span class=\"number\">99670</span>,<span class=\"number\">99642</span>,<span class=\"number\">99919</span>,<span class=\"number\">100401</span>,<span class=\"number\">99785</span>,<span class=\"number\">100627</span>,<span class=\"number\">100215</span>,<span class=\"number\">99507</span></span><br><span class=\"line\">數字<span class=\"number\">6</span>分佈</span><br><span class=\"line\"><span class=\"number\">100332</span>,<span class=\"number\">99879</span>,<span class=\"number\">99976</span>,<span class=\"number\">100143</span>,<span class=\"number\">99614</span>,<span class=\"number\">100319</span>,<span class=\"number\">99665</span>,<span class=\"number\">100169</span>,<span class=\"number\">100380</span>,<span class=\"number\">99523</span></span><br><span class=\"line\">數字<span class=\"number\">7</span>分佈</span><br><span class=\"line\"><span class=\"number\">99878</span>,<span class=\"number\">100407</span>,<span class=\"number\">99804</span>,<span class=\"number\">99669</span>,<span class=\"number\">100115</span>,<span class=\"number\">99760</span>,<span class=\"number\">100251</span>,<span class=\"number\">99602</span>,<span class=\"number\">100124</span>,<span class=\"number\">100390</span></span><br><span class=\"line\">數字<span class=\"number\">8</span>分佈</span><br><span class=\"line\"><span class=\"number\">100104</span>,<span class=\"number\">99888</span>,<span class=\"number\">99876</span>,<span class=\"number\">100575</span>,<span class=\"number\">100181</span>,<span class=\"number\">100229</span>,<span class=\"number\">100083</span>,<span class=\"number\">99398</span>,<span class=\"number\">99632</span>,<span class=\"number\">100034</span></span><br><span class=\"line\">數字<span class=\"number\">9</span>分佈</span><br><span class=\"line\"><span class=\"number\">99758</span>,<span class=\"number\">99632</span>,<span class=\"number\">99929</span>,<span class=\"number\">99860</span>,<span class=\"number\">100196</span>,<span class=\"number\">99972</span>,<span class=\"number\">99582</span>,<span class=\"number\">100052</span>,<span class=\"number\">100453</span>,<span class=\"number\">100566</span></span><br></pre></td></tr></table></figure>\n\n<p>但為何只要這樣交換，就是隨機排序？ 🤔</p>\n<h2 id=\"不嚴謹的證明\"><a href=\"#不嚴謹的證明\" class=\"headerlink\" title=\"不嚴謹的證明\"></a>不嚴謹的證明</h2><p>已知N=1或2時，使用此法皆可使陣列為隨機排序。<br>若N=n時成立，考慮N=n+1時的情況：<br>Without loss of generality，令陣列為[0, 1, 2, …, n]<br>第一個位置的數0會和後面的隨機一個元素交換，此時第一個位置是0到n的數的機率是平均的 $P_0(v)=\\frac{1}{n+1}, v \\in {0, 1, 2, .. n}$<br>此時子陣列(<code>[1:]</code>)即為N=n的情況，依照假設，使用此法後，其餘數字會是隨機排序，<br>所以N=n+1時也成立。<br>依數學歸納法，N=1,2時成立，且N=n成立時，N=n+1也成立；所以N為自然數時，使用此法皆可使陣列為隨機排序。$\\blacksquare$</p>\n<hr>\n<p>一個更直觀的解釋是，每一次交換都是在隨機選擇剩下還沒選的值。</p>\n<h2 id=\"錯誤版本\"><a href=\"#錯誤版本\" class=\"headerlink\" title=\"錯誤版本\"></a>錯誤版本</h2><figure class=\"highlight reasonml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"constructor\">WrongShuffle(Array <span class=\"params\">a</span>)</span>&#123;</span><br><span class=\"line\">    N = a.length</span><br><span class=\"line\">    for (i = <span class=\"number\">0</span> ~ N-<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">        <span class=\"constructor\">Swap(<span class=\"params\">a</span>[<span class=\"params\">i</span>], <span class=\"params\">a</span>[Random <span class=\"params\">value</span> <span class=\"params\">between</span> 0 <span class=\"params\">and</span> N])</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>此版本的所有元素對陣列中的一個元素交換<br>雖然接近，但不是隨機排序</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"code\"><pre><span class=\"line\">數字<span class=\"number\">0</span>分佈</span><br><span class=\"line\"><span class=\"number\">99993</span>,<span class=\"number\">100886</span>,<span class=\"number\">99773</span>,<span class=\"number\">100749</span>,<span class=\"number\">100077</span>,<span class=\"number\">99675</span>,<span class=\"number\">99556</span>,<span class=\"number\">99589</span>,<span class=\"number\">99798</span>,<span class=\"number\">99904</span></span><br><span class=\"line\">數字<span class=\"number\">1</span>分佈</span><br><span class=\"line\"><span class=\"number\">128185</span>,<span class=\"number\">93869</span>,<span class=\"number\">94816</span>,<span class=\"number\">95112</span>,<span class=\"number\">96020</span>,<span class=\"number\">96324</span>,<span class=\"number\">97355</span>,<span class=\"number\">98316</span>,<span class=\"number\">99545</span>,<span class=\"number\">100458</span></span><br><span class=\"line\">數字<span class=\"number\">2</span>分佈</span><br><span class=\"line\"><span class=\"number\">120180</span>,<span class=\"number\">124118</span>,<span class=\"number\">89932</span>,<span class=\"number\">91055</span>,<span class=\"number\">91953</span>,<span class=\"number\">92791</span>,<span class=\"number\">94813</span>,<span class=\"number\">96518</span>,<span class=\"number\">98183</span>,<span class=\"number\">100457</span></span><br><span class=\"line\">數字<span class=\"number\">3</span>分佈</span><br><span class=\"line\"><span class=\"number\">112478</span>,<span class=\"number\">115941</span>,<span class=\"number\">120497</span>,<span class=\"number\">86991</span>,<span class=\"number\">88766</span>,<span class=\"number\">90575</span>,<span class=\"number\">92353</span>,<span class=\"number\">94732</span>,<span class=\"number\">97465</span>,<span class=\"number\">100202</span></span><br><span class=\"line\">數字<span class=\"number\">4</span>分佈</span><br><span class=\"line\"><span class=\"number\">104476</span>,<span class=\"number\">109125</span>,<span class=\"number\">113448</span>,<span class=\"number\">119119</span>,<span class=\"number\">85554</span>,<span class=\"number\">88077</span>,<span class=\"number\">90897</span>,<span class=\"number\">92827</span>,<span class=\"number\">96727</span>,<span class=\"number\">99750</span></span><br><span class=\"line\">數字<span class=\"number\">5</span>分佈</span><br><span class=\"line\"><span class=\"number\">97764</span>,<span class=\"number\">101507</span>,<span class=\"number\">106920</span>,<span class=\"number\">112440</span>,<span class=\"number\">118047</span>,<span class=\"number\">85835</span>,<span class=\"number\">89281</span>,<span class=\"number\">92036</span>,<span class=\"number\">96476</span>,<span class=\"number\">99694</span></span><br><span class=\"line\">數字<span class=\"number\">6</span>分佈</span><br><span class=\"line\"><span class=\"number\">91910</span>,<span class=\"number\">96017</span>,<span class=\"number\">101046</span>,<span class=\"number\">105743</span>,<span class=\"number\">112624</span>,<span class=\"number\">119489</span>,<span class=\"number\">87594</span>,<span class=\"number\">91230</span>,<span class=\"number\">94797</span>,<span class=\"number\">99550</span></span><br><span class=\"line\">數字<span class=\"number\">7</span>分佈</span><br><span class=\"line\"><span class=\"number\">86177</span>,<span class=\"number\">90650</span>,<span class=\"number\">96260</span>,<span class=\"number\">101089</span>,<span class=\"number\">107061</span>,<span class=\"number\">113865</span>,<span class=\"number\">120411</span>,<span class=\"number\">90146</span>,<span class=\"number\">94617</span>,<span class=\"number\">99724</span></span><br><span class=\"line\">數字<span class=\"number\">8</span>分佈</span><br><span class=\"line\"><span class=\"number\">81888</span>,<span class=\"number\">86070</span>,<span class=\"number\">90840</span>,<span class=\"number\">96392</span>,<span class=\"number\">101840</span>,<span class=\"number\">109008</span>,<span class=\"number\">115726</span>,<span class=\"number\">124044</span>,<span class=\"number\">93945</span>,<span class=\"number\">100247</span></span><br><span class=\"line\">數字<span class=\"number\">9</span>分佈</span><br><span class=\"line\"><span class=\"number\">76949</span>,<span class=\"number\">81817</span>,<span class=\"number\">86468</span>,<span class=\"number\">91310</span>,<span class=\"number\">98058</span>,<span class=\"number\">104361</span>,<span class=\"number\">112014</span>,<span class=\"number\">120562</span>,<span class=\"number\">128447</span>,<span class=\"number\">100014</span></span><br></pre></td></tr></table></figure>\n\n<p>為何不是隨機排序？ 🤔 目前想不到直觀解釋</p>\n<p>參考維基的證明：<br>總共有$n^n$種選法，但可能的排列只有$n!$種，在$n&gt;2$時並不能整除</p>\n<h2 id=\"更簡單的實作\"><a href=\"#更簡單的實作\" class=\"headerlink\" title=\"更簡單的實作\"></a>更簡單的實作</h2><p>對每個index設一隨機數，對隨機數排序<br>時間複雜度為$O(n\\log n)$</p>\n<h2 id=\"各語言Shuffle實作\"><a href=\"#各語言Shuffle實作\" class=\"headerlink\" title=\"各語言Shuffle實作\"></a>各語言Shuffle實作</h2><p>都是Fisher-Yates</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9uL2Jsb2IvY2IwNzQ4ZDM5MzljMzExNjhhYjVkM2I4MGUzNjc3NDk0NDk3ZDVlMy9MaWIvcmFuZG9tLnB5I0wyODY=\">Python<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9saWJjeHgvYmxvYi8yN2M4MzZmZjNhOWM1MDVkZWI5ZmQxNjE2MDEyOTI0ZGU4ZmY5Mjc5L2luY2x1ZGUvYWxnb3JpdGhtI0wyNzg3\">LLVM C++<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h2><ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlzaGVyJUUyJTgwJTkzWWF0ZXNfc2h1ZmZsZQ==\">Wiki<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW9wbGUuY3MudW1hc3MuZWR1L35waGFhcy9DUzU5ME0vaGFuZG91dHMvRmlzaGVyLVlhdGVzLXByb29mLnBkZg==\">https://people.cs.umass.edu/~phaas/CS590M/handouts/Fisher-Yates-proof.pdf<i class=\"fa fa-external-link-alt\"></i></span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jcy5zdGFja2V4Y2hhbmdlLmNvbS9xdWVzdGlvbnMvMjE1Mi9ob3ctdG8tcHJvdmUtY29ycmVjdG5lc3Mtb2YtYS1zaHVmZmxlLWFsZ29yaXRobQ==\">https://cs.stackexchange.com/questions/2152/how-to-prove-correctness-of-a-shuffle-algorithm<i class=\"fa fa-external-link-alt\"></i></span></li>\n</ul>\n",
            "tags": [
                "演算法",
                "隨機排序",
                "洗牌",
                "Fisher-Yates",
                "證明"
            ]
        }
    ]
}