<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon.webp">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon.webp">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon.webp">
  <link rel="mask-icon" href="/img/favicon.webp" color="#222">
  <meta name="google-site-verification" content="45plYlJRhxb-g8Tl8seizYgih_JUsmcJRH6oJHplkj0">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+TC:300,300italic,400,400italic,700,700italic%7CCormorant+Garamond:300,300italic,400,400italic,700,700italic%7CNoto+Serif+TC:300,300italic,400,400italic,700,700italic%7CFira+Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/green/pace-theme-barber-shop.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"gitqwerty777.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.12.1","exturl":true,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"show_result":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInDown","sidebar":"fadeInRight"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/config.min.js"></script>

    <meta name="description" content="http:&#x2F;&#x2F;mqjing.blogspot.tw&#x2F;2009&#x2F;09&#x2F;cmake-how-to-use-cmake.htmlCMake 常用變數 簡介CMake用來產生跨平台的專案建置文件，在windows下它會生成visual studio的專案檔(.sln) codeblock eclipse，在linux下它會生成Makefile。類似工具有autotools和qmake，不過autoto">
<meta property="og:type" content="article">
<meta property="og:title" content="Makefile 和 CMake 之間的轉換和實作">
<meta property="og:url" content="http://gitqwerty777.github.io/cmake/index.html">
<meta property="og:site_name" content="QWERTY">
<meta property="og:description" content="http:&#x2F;&#x2F;mqjing.blogspot.tw&#x2F;2009&#x2F;09&#x2F;cmake-how-to-use-cmake.htmlCMake 常用變數 簡介CMake用來產生跨平台的專案建置文件，在windows下它會生成visual studio的專案檔(.sln) codeblock eclipse，在linux下它會生成Makefile。類似工具有autotools和qmake，不過autoto">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2017-01-17T10:12:50.000Z">
<meta property="article:modified_time" content="2017-01-17T10:12:50.000Z">
<meta property="article:author" content="qwerty">
<meta property="article:tag" content="CMake">
<meta property="article:tag" content="Makefile">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://gitqwerty777.github.io/cmake/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"http://gitqwerty777.github.io/cmake/","path":"cmake/","title":"Makefile 和 CMake 之間的轉換和實作"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Makefile 和 CMake 之間的轉換和實作 | QWERTY</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-51310670-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-51310670-1","only_pageview":false}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/third-party/analytics/google-analytics.min.js"></script>
<script data-ad-client="ca-pub-7267358872858108" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="QWERTY" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">QWERTY</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Hello World!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章<span class="badge">63</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>關於</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fas fa-rss-square fa-fw"></i>RSS</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤<span class="badge">155</span></a></li><li class="menu-item menu-item-ptt標籤雲"><span class="exturl" data-url="aHR0cHM6Ly9xd2VydHk3NzcubWUvcHR0LXRhZy1jbG91ZC8="><i class="fas fa-hashtag fa-fw"></i>PTT標籤雲</span></li><li class="menu-item menu-item-支語警察"><a href="/foreign-terms-police" rel="section"><i class="fas fa-language fa-fw"></i>支語警察</a></li><li class="menu-item menu-item-英文聊天機器人"><span class="exturl" data-url="aHR0cHM6Ly9jaGF0Ym90LnF3ZXJ0eTc3Ny5tZQ=="><i class="fas fa-comment-dots fa-fw"></i>英文聊天機器人</span></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B0%A1%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">簡介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">2.</span> <span class="nav-text">使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GUI"><span class="nav-number">2.1.</span> <span class="nav-text">GUI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Out-Of-Source-Build"><span class="nav-number">2.2.</span> <span class="nav-text">Out-Of-Source Build</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AA%9E%E6%B3%95"><span class="nav-number">3.</span> <span class="nav-text">語法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake%E8%AA%9E%E6%B3%95"><span class="nav-number">3.1.</span> <span class="nav-text">CMake語法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-%E8%AE%8A%E6%95%B8"><span class="nav-number">3.2.</span> <span class="nav-text">CMake 變數</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-Application"><span class="nav-number">3.3.</span> <span class="nav-text">CMake Application</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%88%E6%A1%88%E8%AA%AA%E6%98%8E"><span class="nav-number">4.</span> <span class="nav-text">專案說明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Makefile-%E5%92%8C-CMake-%E7%9A%84%E8%AA%9E%E6%B3%95%E6%AF%94%E8%BC%83"><span class="nav-number">5.</span> <span class="nav-text">Makefile 和 CMake 的語法比較</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A8%AD%E5%AE%9A%E8%AE%8A%E6%95%B8%E7%AF%84%E4%BE%8B"><span class="nav-number"></span> <span class="nav-text">設定變數範例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%AE%8A%E6%95%B8%E7%AF%84%E4%BE%8B"><span class="nav-number"></span> <span class="nav-text">使用變數範例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-macro-%E7%AF%84%E4%BE%8B"><span class="nav-number"></span> <span class="nav-text">建立 macro 範例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-macro-%E7%AF%84%E4%BE%8B"><span class="nav-number"></span> <span class="nav-text">使用 macro 範例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%98%E5%8F%96%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8%E7%9A%84%E7%AF%84%E4%BE%8B"><span class="nav-number"></span> <span class="nav-text">存取環境變數的範例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A0%E5%85%A5-Post-Build-%E7%9A%84%E7%AF%84%E4%BE%8B"><span class="nav-number"></span> <span class="nav-text">加入 Post Build 的範例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MFC-%E8%A8%AD%E5%AE%9A"><span class="nav-number">1.</span> <span class="nav-text">MFC 設定</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A8%AD%E5%AE%9A-source-code-%E7%BE%A4%E7%B5%84%E7%AF%84%E4%BE%8B"><span class="nav-number"></span> <span class="nav-text">設定 source code 群組範例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-dll-%E7%AF%84%E4%BE%8B"><span class="nav-number"></span> <span class="nav-text">建立 dll 範例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">1.</span> <span class="nav-text">Reference</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="qwerty"
      src="/img/qwerty.webp">
  <p class="site-author-name" itemprop="name">qwerty</p>
  <div class="site-description" itemprop="description">Programming | Computer Science | Thought</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">155</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cDovL2dpdGh1Yi5jb20vZ2l0cXdlcnR5Nzc3" title="GitHub → http:&#x2F;&#x2F;github.com&#x2F;gitqwerty777"><i class="fab fa-github fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOmdvb2hjbDc3N0BnbWFpbC5jb20=" title="E-Mail → mailto:goohcl777@gmail.com"><i class="fa fa-envelope fa-fw"></i></span>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpoX1RX"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9xd2VydHk3NzcubWU=" title="https:&#x2F;&#x2F;qwerty777.me">My Main Page</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9saWZlLnF3ZXJ0eTc3Ny5tZQ==" title="https:&#x2F;&#x2F;life.qwerty777.me">My Second Blog -- Wysiwyg</span>
        </li>
    </ul>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="回到頂端">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dpdHF3ZXJ0eTc3Nw==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://gitqwerty777.github.io/cmake/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/qwerty.webp">
      <meta itemprop="name" content="qwerty">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QWERTY">
      <meta itemprop="description" content="Programming | Computer Science | Thought">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Makefile 和 CMake 之間的轉換和實作 | QWERTY">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Makefile 和 CMake 之間的轉換和實作
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2017-01-17 18:12:50" itemprop="dateCreated datePublished" datetime="2017-01-17T18:12:50+08:00">2017-01-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AD%86%E8%A8%98/" itemprop="url" rel="index"><span itemprop="name">筆記</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>11k</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <!-- RENEW: -->

<p><span class="exturl" data-url="aHR0cDovL21xamluZy5ibG9nc3BvdC50dy8yMDA5LzA5L2NtYWtlLWhvdy10by11c2UtY21ha2UuaHRtbA==">http://mqjing.blogspot.tw/2009/09/cmake-how-to-use-cmake.html<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9pdGsub3JnL1dpa2kvQ01ha2VfVXNlZnVsX1ZhcmlhYmxlcw==">CMake 常用變數<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h2><p>CMake用來產生跨平台的專案建置文件，在windows下它會生成visual studio的專案檔(.sln) codeblock eclipse，在linux下它會生成Makefile。類似工具有autotools和qmake，不過autotools太複雜，qmake只限於qt使用。</p>
<p>CMake用更抽象的語法來組織項目。例如用math表示數學庫，而不需要再具體指定到底是math.dll還是libmath.so。</p>
<span id="more"></span>

<p>類似功能的工具</p>
<ul>
<li><p><span class="exturl" data-url="aHR0cDovL3d3dy5zY29ucy5vcmcv">SCons<i class="fa fa-external-link-alt"></i></span></p>
<ul>
<li>by python</li>
</ul>
</li>
<li><p><span class="exturl" data-url="aHR0cDovL2FudC5hcGFjaGUub3JnLw==">Apache ant<i class="fa fa-external-link-alt"></i></span></p>
<ul>
<li>by java</li>
</ul>
</li>
<li><p>優點</p>
<ul>
<li>stable</li>
<li>fast</li>
<li>支援Code::Blocks, Xcode等</li>
</ul>
</li>
<li><p>缺點</p>
<ul>
<li>需學習語法</li>
</ul>
</li>
</ul>
<p><span class="exturl" data-url="aHR0cHM6Ly9iaXRidWNrZXQub3JnL3Njb25zL3Njb25zL3dpa2kvU2NvbnNWc090aGVyQnVpbGRUb29scw==">專案建置工具比較<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h3><ul>
<li>command line: <code>cmake</code></li>
<li>curse-based TUI: <code>ccmake</code></li>
<li>QT-based GUI: <code>cmake-gui</code></li>
</ul>
<h3 id="Out-Of-Source-Build"><a href="#Out-Of-Source-Build" class="headerlink" title="Out-Of-Source Build"></a>Out-Of-Source Build</h3><p>將build資料和原始碼分離</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改 CMakeLists.txt</span></span><br><span class="line">mkdir build # will generate build files in this folder</span><br><span class="line">cd build</span><br><span class="line">cmake .. # the place that put CMakelists.txt</span><br><span class="line"></span><br><span class="line">cmake -G &quot;Unix Makefiles&quot; [CMakeList.txt path] # 指定生成平台</span><br></pre></td></tr></table></figure>

<ul>
<li>執行結束後，build資料夾會出現各項中間檔、makefile 以及執行檔</li>
</ul>
<p>優點</p>
<ol>
<li>可保持working directory的乾淨</li>
<li>只要用新的資料夾，就可以產生多個不同的build，也可以隨時刪除</li>
</ol>
<h2 id="語法"><a href="#語法" class="headerlink" title="語法"></a>語法</h2><ul>
<li>設定變數 <code>set(var hello)</code></li>
<li>印出訊息 <code>message($&#123;var&#125;)</code></li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span> (VERSION <span class="number">2.6</span>) <span class="comment"># minimum executable version of cmake</span></span><br><span class="line"><span class="keyword">project</span>(ex1) <span class="comment"># project name</span></span><br><span class="line"><span class="keyword">add_executable</span>(ex1 main.c) <span class="comment"># build program ex1 from main.c</span></span><br></pre></td></tr></table></figure>

<p>在不同的資料夾下建立執行檔</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">relative destination</span></span><br><span class="line">cmake --help-variable CMAKE_INSTALL_PREFIX</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">At Install-time use DESTDIR mechanism (Unix Makefiles)</span></span><br><span class="line">make DESTDIR=/tmp/testinstall install</span><br></pre></td></tr></table></figure>

<h3 id="CMake語法"><a href="#CMake語法" class="headerlink" title="CMake語法"></a>CMake語法</h3><p>general purpose constructs: <code>set</code>, <code>unset</code>, <code>if</code>, <code>elseif</code>, <code>else</code>, <code>endif</code>, <code>foreach</code>, <code>while</code>, <code>break</code></p>
<h3 id="CMake-變數"><a href="#CMake-變數" class="headerlink" title="CMake 變數"></a>CMake 變數</h3><p>變數不分大小寫，但我習慣性用大寫</p>
<ul>
<li><p>變數指定</p>
<ul>
<li>CMake 有許多預設變數，以改變基本的運作，用<code>cmake --help-variables-list</code>可以瀏覽</li>
<li>在檔案內指定<ul>
<li><code>set(CMAKE_INSTALL_PREFIX /home/eric/testinstall)</code></li>
</ul>
</li>
</ul>
</li>
<li><p>平台相關變數</p>
<ul>
<li>作業系統<ul>
<li><code>WIN32</code> True on windows systems, including win64.</li>
<li><code>UNIX</code> True for UNIX and UNIX like operating systems.</li>
<li><code>APPLE</code> True if running on Mac OSX.</li>
<li><code>CYGWIN</code> True for cygwin.</li>
</ul>
</li>
<li>編譯器<ul>
<li><code>MSVC</code> True when using Microsoft Visual C</li>
<li><code>GNU&lt;LANG&gt;</code> True if the compiler of this language is GNU</li>
<li><code>MINGW</code> True if the compiler is MinGW</li>
</ul>
</li>
<li>example  <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">NOT</span> WIN32)</span><br><span class="line"><span class="keyword">option</span> (WITH GUESS NAME <span class="string">&quot;Guess acronym name&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">endif</span> (<span class="keyword">NOT</span> WIN32)</span><br></pre></td></tr></table></figure></li>
<li>找需要的package  <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find package ( LibXml2 )</span><br><span class="line"><span class="keyword">if</span> (LIBXML2 FOUND)</span><br><span class="line">add definitions (−DHAVE XML <span class="variable">$&#123;LIBXML2 DEFINITIONS &#125;</span>)</span><br><span class="line">includedirectories( <span class="variable">$&#123;LIBXML2 INCLUDE DIR &#125;</span>)</span><br></pre></td></tr></table></figure></li>
<li><code>XXXFOUND</code><br>- Set to false, or undefined, if we haven’t found, or don’t want to use XXX<ul>
<li><code>XXX_INCLUDE_DIRS</code><ul>
<li>The final set of include directories listed in one variable for use by client code</li>
</ul>
</li>
<li><code>XXX_LIBRARIES</code><ul>
<li>The libraries to link against to use XXX. These should include full paths</li>
</ul>
</li>
<li><code>XXX_DEFINITIONS</code><ul>
<li>Definitions to use when compiling code that uses XXX</li>
</ul>
</li>
<li><code>XXX_EXECUTABLE</code><ul>
<li>Where to find the XXX tool</li>
</ul>
</li>
<li><code>XXX_LIBRARY_DIRS</code><ul>
<li>Optionally, the final set of library directories listed in one variable for use by client code</li>
</ul>
</li>
<li>to find an executable program<ul>
<li><code>find_program</code></li>
</ul>
</li>
<li>to find a library<ul>
<li><code>find_library</code></li>
</ul>
</li>
<li>to find any kind of file<ul>
<li><code>find_file</code></li>
</ul>
</li>
<li>to find a path where a file reside<ul>
<li><code>find_path</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>file manipulation with file</p>
<ul>
<li><code>READ</code>, <code>WRITE</code>, <code>APPEND</code>, <code>RENAME</code>, <code>REMOVE</code>, <code>MAKE DIRECTORY</code></li>
</ul>
</li>
<li><p>advanced files operations</p>
<ul>
<li><code>GLOB</code>, <code>GLOB RECURSE [file name in a path]</code>, <code>DOWNLOAD</code>, <code>UPLOAD</code></li>
</ul>
</li>
<li><p>working with path</p>
<ul>
<li><code>file (TO CMAKE PATH /TO NATIVE PATH ...)</code>, get filename component</li>
</ul>
</li>
<li><p>execute an external process (with stdout, stderr and return code retrieval): execute process</p>
</li>
<li><p>builtin list manipulation command</p>
<ul>
<li><code>LENGTH</code>, <code>GET</code>, <code>APPEND</code>, <code>FIND</code>, <code>APPEND</code>, <code>INSERT</code>, <code>REMOVE ITEM</code>, <code>REMOVE AT</code>, <code>REMOVE DUPLICATES REVERSE</code>, <code>SORT</code></li>
</ul>
</li>
<li><p>string manipulation</p>
<ul>
<li>upper&#x2F;lower case conversion, length, comparison, substring, regular expression match</li>
</ul>
</li>
</ul>
<h3 id="CMake-Application"><a href="#CMake-Application" class="headerlink" title="CMake Application"></a>CMake Application</h3><ul>
<li><p>CPack</p>
<ul>
<li>CMake friend application</li>
<li>used to easily package your software</li>
<li>Package the resulting binaries with CPack</li>
</ul>
</li>
<li><p>CTest</p>
<ul>
<li>make test</li>
<li>runs systematic test with CTest and publish them with CDash</li>
</ul>
</li>
<li><p>Wizard mode</p>
<ul>
<li>cmake -i, interactive equivalent of the Normal mode</li>
</ul>
</li>
<li><p>Command mode</p>
<ul>
<li>cmake -E <command>, command line mode which offers basic command in a portable way</li>
</ul>
</li>
</ul>
<h2 id="專案說明"><a href="#專案說明" class="headerlink" title="專案說明"></a>專案說明</h2><p>一個簡單的圍棋程式</p>
<p>file tree</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── CMakeLists.txt</span><br><span class="line">├── *<span class="string">.h</span></span><br><span class="line">├── *<span class="string">.cpp</span></span><br><span class="line">├── previous_<span class="keyword">version</span></span><br><span class="line">│   ├── CMakeLists.txt</span><br><span class="line">│   ├── *<span class="string">.cpp</span></span><br><span class="line">│   └── *<span class="string">.h</span></span><br></pre></td></tr></table></figure>

<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">P?=binary</span><br><span class="line">EXEC=execs/<span class="variable">$(P)</span></span><br><span class="line">OBJECTS=<span class="variable">$(P)</span>.o *.o</span><br><span class="line">CXXFLAGS=-pipe -std=c++11 -Wall -Wextra -Wpedantic -Wno-unknown-pragmas -g -O3 -march=native -fopenmp</span><br><span class="line">LDFLAGS=-lpthread</span><br><span class="line">CXX=g++</span><br><span class="line"></span><br><span class="line"><span class="section">all: main</span></span><br><span class="line"><span class="section">parallel: main</span></span><br><span class="line"><span class="section">parallel: CXXFLAGS+=-fopenmp -DPARALLEL # add additional flags</span></span><br><span class="line"></span><br><span class="line"><span class="section">previous:</span></span><br><span class="line">    cd previous_version; make</span><br><span class="line"><span class="section">binary: <span class="variable">$(OBJECTS)</span></span></span><br><span class="line">	g++ <span class="variable">$(CXXFLAGS)</span> <span class="variable">$(OBJECTS)</span> -flto -o <span class="variable">$(EXEC)</span> <span class="variable">$(LDFLAGS)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(P)</span>.o: *.h</span><br><span class="line">	<span class="variable">$(CXX)</span> <span class="variable">$(CXXFLAGS)</span> main.cpp -c -o <span class="variable">$(P)</span>.o <span class="variable">$(LDFLAGS)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># object files and it&#x27;s dependency</span></span><br><span class="line"><span class="section">board.o: mc_node.h liberty.h board.h board_constants.h ladder.h database.h strategy.h gameSetting.h</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -rf *.o</span><br><span class="line"><span class="section">previous_clean:</span></span><br><span class="line">	cd previous_version; make clean</span><br></pre></td></tr></table></figure>

<p>CMakeLists.txt in root directory</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.6</span>)</span><br><span class="line"><span class="keyword">project</span>(MCTS_Go9x9)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set default output file name</span></span><br><span class="line"><span class="keyword">SET</span>(BINARYNAME <span class="string">&quot;binary&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;default binary file&#x27;s name = binary&quot;</span> FORCE)</span><br><span class="line"><span class="comment"># set output directory</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/execs</span><br><span class="line"><span class="comment"># compile parameters</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_COMPILER g++)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;compiler: $&#123;CMAKE_CXX_COMPILER&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;-pipe -std=c++11 -Wall -Wextra -Wpedantic -Wno-unknown-pragmas -g -O3 -march=native -fopenmp&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;cxxflags: $&#123;CMAKE_CXX_FLAGS&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="string">&quot;-flto&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(THREADS_PREFER_PTHREAD_FLAG <span class="keyword">ON</span>) <span class="comment"># pthread</span></span><br><span class="line"><span class="keyword">find_package</span>(Threads REQUIRED) <span class="comment"># pthread</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(SRC_FILES *.cpp)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;source files: $&#123;SRC_FILES&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># each executable is a target in GNU makefile</span></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">$&#123;BINARYNAME&#125;</span> <span class="variable">$&#123;SRC_FILES&#125;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;BINARYNAME&#125;</span> Threads::Threads) <span class="comment"># pthread</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># parallel</span></span><br><span class="line"><span class="keyword">add_executable</span>(parallel <span class="variable">$&#123;SRC_FILES&#125;</span>)</span><br><span class="line"><span class="keyword">target_compile_options</span>(parallel PUBLIC -fopenmp -DPARALLEL) <span class="comment"># add additional compile parameters</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># we have another CMakeLists.txt in this directory, still follow the same method to generate</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(previous_version)</span><br></pre></td></tr></table></figure>

<h2 id="Makefile-和-CMake-的語法比較"><a href="#Makefile-和-CMake-的語法比較" class="headerlink" title="Makefile 和 CMake 的語法比較"></a>Makefile 和 CMake 的語法比較</h2><table>
<thead>
<tr>
<th>makefile</th>
<th>cmake</th>
</tr>
</thead>
<tbody><tr>
<td><code>COMPILE_FLAGS = -c -m32 -O3 -fPIC -w -DSOMETHING -Wall -I src/sdk/core</code></td>
<td><code>SET( COMPILE_FLAGS &quot;-c -m32 -O3 -fPIC -w DSOMETHING -Wall&quot; ) INCLUDE_DIRECTORIES( src/sdk/core )</code></td>
</tr>
</tbody></table>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Makefile</span></span><br><span class="line"><span class="keyword">ifdef</span> STATIC</span><br><span class="line">  <span class="comment"># Do something</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># Do something elseendif</span></span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMake</span></span><br><span class="line"><span class="keyword">OPTION</span>(STATIC <span class="string">&quot;Brief description&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">IF</span>( STATIC )</span><br><span class="line">  <span class="comment"># Do something</span></span><br><span class="line"><span class="keyword">ELSE</span>()</span><br><span class="line">  <span class="comment"># Do something else</span></span><br><span class="line"><span class="keyword">ENDIF</span>()</span><br></pre></td></tr></table></figure>

<p>using libraries<br>call find_package with the name of your library, which will invoke a library search script from your cmake module path. This script (which is also written in CMake) will attempt to detect the location of the library’s header and lib files and store them in a couple of CMake variables that can then be passed to the according CMake commands like include_directories and target_link_libraries.</p>
<p>There are two problems with this approach: First, you need a search script. Fortunately, CMake ships with search scripts for Pthreads, Boost and a couple of others, but if you are using a more exotic library, you might have to write the search script yourself, which is kind of an arcane experience at first…</p>
<p> 並不會刪除自身產出的快取和中間檔</p>
<p>The following Makefile builds an executable named prog from the sources prog1.c, prog2.c, prog3.c and main.c. prog is linked against libmystatlib.a and libmydynlib.so which are both also built from source. Additionally, prog uses the library libstuff.a in stuff&#x2F;lib and its header in stuff&#x2F;include. The Makefile by default builds a release target, but offers also a debug target:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Makefile</span></span><br><span class="line">CC = gcc</span><br><span class="line">CPP = g++</span><br><span class="line">RANLIB = ar rcs</span><br><span class="line">RELEASE = -c -O3</span><br><span class="line">DEBUG = -c -g -D_DEBUG</span><br><span class="line">INCDIR = -I./stuff/<span class="keyword">include</span></span><br><span class="line">LIBDIR = -L./stuff/lib -L.</span><br><span class="line">LIBS = -lstuff -lmystatlib -lmydynlib</span><br><span class="line">CFLAGS = <span class="variable">$(RELEASE)</span></span><br><span class="line"></span><br><span class="line">PROGOBJS = prog1.o prog2.o prog3.o</span><br><span class="line"></span><br><span class="line"><span class="section">prog: main.o <span class="variable">$(PROGOBJS)</span> mystatlib mydynlib</span></span><br><span class="line">    <span class="variable">$(CC)</span> main.o <span class="variable">$(PROGOBJS)</span> <span class="variable">$(LIBDIR)</span> <span class="variable">$(LIBS)</span> -o prog</span><br><span class="line"><span class="section">debug: CFLAGS=<span class="variable">$(DEBUG)</span></span></span><br><span class="line"><span class="section">debug: prog</span></span><br><span class="line"></span><br><span class="line"><span class="section">mystatlib: mystatlib.o</span></span><br><span class="line">    <span class="variable">$(RANLIB)</span> libmystatlib.a mystatlib.o</span><br><span class="line"><span class="section">mydynlib: mydynlib.o</span></span><br><span class="line">    <span class="variable">$(CPP)</span> -shared mydynlib.o -o libmydynlib.so</span><br><span class="line"></span><br><span class="line"><span class="section">%.o: %.c</span></span><br><span class="line">    <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> <span class="variable">$(INCDIR)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="section">%.o: %.cpp</span></span><br><span class="line">    <span class="variable">$(CPP)</span> <span class="variable">$(CFLAGS)</span> <span class="variable">$(INCDIR)</span> -fPIC  <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line">Here is a CMakeLists.txtthat does (almost) exactly the same, with some comments to underline the similarities to the Makefile:</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#CMakeLists.txt</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>)                    <span class="comment"># stuff not directly</span></span><br><span class="line"><span class="keyword">project</span>(example)                                       <span class="comment"># related to building</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/stuff/<span class="keyword">include</span>) <span class="comment"># -I flags for compiler</span></span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/stuff/lib)        <span class="comment"># -L flags for linker</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(PROGSRC prog1.c prog2.c prog3.c)                   <span class="comment"># define variable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(prog main.c <span class="variable">$&#123;PROGSRC&#125;</span>)                 <span class="comment"># define executable target prog, specify sources</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(prog mystatlib mydynlib stuff)   <span class="comment"># -l flags for linking prog target</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(mystatlib STATIC mystatlib.c)              <span class="comment"># define static library target mystatlib, specify sources</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(mydynlib SHARED mydynlib.cpp)              <span class="comment"># define shared library target mydynlib, specify sources</span></span><br><span class="line"><span class="comment">#extra flags for linking mydynlib</span></span><br><span class="line"><span class="keyword">set_target_properties</span>(mydynlib PROPERTIES POSITION_INDEPENDENT_CODE <span class="keyword">TRUE</span>)</span><br><span class="line"><span class="comment">#alternatively:</span></span><br><span class="line"><span class="comment">#set_target_properties(mydynlib PROPERTIES COMPILE_FLAGS &quot;-fPIC&quot;)</span></span><br></pre></td></tr></table></figure>
<p>In this simple example, the most important differences are:</p>
<p>CMake recognizes which compilers to use for which kind of source. Also, it invokes the right sequence of commands for each type of target. Therefore, there is no explicit specification of commands like $(CC)…, $(RANLIB)… and so on.<br>All usual compiler&#x2F;linker flags dealing with inclusion of header files, libraries, etc. are replaced by platform independent &#x2F; build system independent commands.<br>Debugging flags are included by either setting the variable CMAKE_BUILD_TYPE to “Debug”, or by passing it to CMake when invoking the program: cmake -DCMAKE_BUILD_TYPE:STRING&#x3D;Debug.<br>CMake offers also the platform independent inclusion of the ‘-fPIC’ flag (via the POSITION_INDEPENDENT_CODE property) and many others. Still, more obscure settings can be implemented by hand in CMake just as well as in a Makefile (by using COMPILE_FLAGS and similar properties). Of course CMake really starts to shine when third party libraries (like OpenGL) are included in a portable manner.<br>The build process has one step if you use a Makefile, namely typing<br>make at the command line. For CMake, there are two steps: First, you need to setup your build environment (either by typing cmake <source_dir> in your build directory or by running some GUI client). This creates a Makefile or something equivalent, depending on the build system of your choice (e.g. make on Unixes or VC++ or MinGW + Msys on Windows). The build system can be passed to CMake as a parameter; however, CMake makes reasonable default choices depending on your system configuration. Second, you perform the actual build in the selected build system.<br>Sources and build instructions are available at <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Job2VsemVsL21ha2VfY21ha2U=">https://github.com/rhoelzel/make_cmake<i class="fa fa-external-link-alt"></i></span>.</p>
<h1 id="設定變數範例"><a href="#設定變數範例" class="headerlink" title="設定變數範例"></a>設定變數範例</h1><pre><code>      set(MYLIBPATH &quot;C:\\Documents and
              Settings\\Jing\\Desktop\\opencv_bin\\lib\\release\\&quot;)
</code></pre>
<h1 id="使用變數範例"><a href="#使用變數範例" class="headerlink" title="使用變數範例"></a>使用變數範例</h1><pre><code>      target_link_libraries($&#123;name&#125; $&#123;MYLIBPATH&#125;cv200.lib)
</code></pre>
<h1 id="建立-macro-範例"><a href="#建立-macro-範例" class="headerlink" title="建立 macro 範例"></a>建立 macro 範例</h1><pre><code>       MACRO(MY_DEFINE_EXAMPLE name srcs)
             add_executable($&#123;name&#125; $&#123;srcs&#125;)
       ENDMACRO(MY_DEFINE_EXAMPLE)
</code></pre>
<h1 id="使用-macro-範例"><a href="#使用-macro-範例" class="headerlink" title="使用 macro 範例"></a>使用 macro 範例</h1><pre><code>       MY_DEFINE_EXAMPLE(demo     demo.cpp)
</code></pre>
<h1 id="存取環境變數的範例"><a href="#存取環境變數的範例" class="headerlink" title="存取環境變數的範例"></a>存取環境變數的範例</h1><pre><code>         MESSAGE(&quot;$ENV&#123;PATH&#125;&quot;)
</code></pre>
<h1 id="加入-Post-Build-的範例"><a href="#加入-Post-Build-的範例" class="headerlink" title="加入 Post Build 的範例"></a>加入 Post Build 的範例</h1><pre><code>add_custom_command(
        TARGET $&#123;MyPluginTarget&#125;
        POST_BUILD
        COMMAND copy
                       $&#123;CMAKE_CFG_INTDIR&#125;\\$&#123;MyPluginTarget&#125;.dll
                       &quot;C:\\Program Files\\Mozilla Firefox\\
                         plugins\\$&#123;MyPluginTarget&#125;.dll&quot;
    )
</code></pre>
<p>若你的執行檔是 Windows 程式, 請加入 Win32<br><code>add_executable(demo WIN32 $&#123;SOURCE&#125;)</code></p>
<h2 id="MFC-設定"><a href="#MFC-設定" class="headerlink" title="MFC 設定"></a>MFC 設定</h2><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span>(CMAKE_MFC_FLAG <span class="number">2</span>)</span><br><span class="line">set_target_properties(MyApp      PROPERTIES</span><br><span class="line">COMPILE_DEFINITIONS</span><br><span class="line"><span class="variable">_AFXDLL</span>, <span class="variable">_UNICODE</span>, UNICODE,</span><br><span class="line"><span class="variable">_BIND_TO_CURRENT_CRT_VERSION</span>,</span><br><span class="line"><span class="variable">_BIND_TO_CURRENT_MFC_VERSION</span></span><br><span class="line">LINK_FLAGS</span><br><span class="line"><span class="string">&quot; /ENTRY:\&quot;</span>wWinMainCRTStartup\<span class="string">&quot;    &quot;</span>)</span><br></pre></td></tr></table></figure>

<p>add_executable(demo WIN32 ${SOURCE})</p>
<h1 id="設定-source-code-群組範例"><a href="#設定-source-code-群組範例" class="headerlink" title="設定 source code 群組範例"></a>設定 source code 群組範例</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ex1:</span></span><br><span class="line"><span class="keyword">file</span>(GLOB_RECURSE myRESOURCE_FILE 「*.def」 「*.rc」)</span><br><span class="line"><span class="keyword">source_group</span>(Resource FILES <span class="variable">$&#123;myRESOURCE_FILE &#125;</span>)</span><br><span class="line"><span class="comment"># ex2:</span></span><br><span class="line"><span class="keyword">source_group</span>(abc_group REGULAR_EXPRESSION <span class="string">&quot;abc.*&quot;</span>)</span><br><span class="line"><span class="keyword">source_group</span>(<span class="number">123</span>_group REGULAR_EXPRESSION <span class="string">&quot;123.*&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(SOURCE abc.cpp abc.h <span class="number">123</span>.cpp <span class="number">123</span>.h abc.rc main.cpp main.h</span><br><span class="line">resource.h stdafx.cpp  stdafx.h</span><br><span class="line">./res/<span class="number">123</span>.ico ./res/<span class="number">123</span>.rc2)</span><br><span class="line"><span class="keyword">add_executable</span>(demo WIN32 <span class="variable">$&#123;SOURCE&#125;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="建立-dll-範例"><a href="#建立-dll-範例" class="headerlink" title="建立 dll 範例"></a>建立 dll 範例</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>( <span class="keyword">target</span> SHARED a.c b.c);</span><br></pre></td></tr></table></figure>
<p>#console 與 windows (&#x2F;SUBSYSTEM:CONSOLE or &#x2F;SUBSYSTEM:WINDOWS)<br>a. 如果你的程式是 Windows.<br>&#x3D;&gt; 則 add_executable(demo WIN32 ${SOURCE})<br>b. 如果是 console, 則<br>&#x3D;&gt; 則 add_executable(demo ${SOURCE})</p>
<p>好用的變數 (more)<br><code>PROJECT_SOURCE_DIR</code>:  包含 project 命令的 CMakeFile.txt 完整路徑. (ex: c:\abc)</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(PROJECT_HOME <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>\\..\\)</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzI3NDU1OTYzL2Fuc3dlci8zNjcyMjk5Mg==">make makefile cmake qmake都是什麼，有什麼區別？-玟清的回答-知乎<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnNpbXBseXBhdHJpY2suY29tL3Bvc3RzLzIwMTUvMDYtMTktY21ha2Utbm90ZXMv">CMake筆記<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1RoZUVyay9DTWFrZS10dXRvcmlhbA==">Eric Noulard - CMake tutorial<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpYm9va3Mub3JnL3dpa2kvQ01ha2VfJUU1JTg1JUE1JUU5JTk2JTgw">CMake 入門 - 維基教科書，自由的教學讀本<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMDg4MjAzMC9jbWFrZS12cy1tYWtlLXNhbXBsZS1jb2Rlcw==">stackoverflow - Cmake vs make sample codes?<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMDA4NTk0NS9jbWFrZS1jZmxhZ3MtY3h4ZmxhZ3MtbW9kaWZpY2F0aW9u">stackoverflow - cmake CFLAGS CXXFLAGS modification<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTY2NTA4MjUvY29udmVydGluZy1vbGQtbWFrZWZpbGUtdG8tY21ha2U=">stackoverflow - Converting old makefile to CMake<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvOTk4NTgzOS9jcmVhdGluZy1jbWFrZWxpc3RzLWZpbGUtZnJvbS1leGlzdGluZy1tYWtlZmlsZQ==">stackoverflow - Creating CMakeLists file from existing Makefile<i class="fa fa-external-link-alt"></i></span></li>
</ul>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="followme">
  <span>歡迎訂閱RSS</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="/atom.xml">
          <span class="icon">
            <i class="fa fa-rss"></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/cmake/" rel="tag"><i class="fa fa-tag"></i> CMake</a>
              <a href="/tags/makefile/" rel="tag"><i class="fa fa-tag"></i> Makefile</a>
              <a href="/tags/linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/economics2/" rel="prev" title="經濟學二">
                  <i class="fa fa-chevron-left"></i> 經濟學二
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/proper-blog-theme-features/" rel="next" title="hexo 網誌主題選擇">
                  hexo 網誌主題選擇 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2014 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fab fa-free-code-camp"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qwerty</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>總字數：</span>
    <span title="總字數">473k</span>
  </span>
</div>
  <div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9waXNjZXMv">NexT.Pisces</span> 強力驅動
  </div>
  <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-61c5cf9cb3476405" async="async"></script>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/comments.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/motion.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/next-boot.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/pjax.min.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/third-party/search/local-search.min.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"forest","dark":"forest"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js","integrity":"sha256-8L3O8tirFUa8Va4NSTAyIbHJeLd6OnlcxgupV9F77e0="}}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/third-party/tags/mermaid.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/third-party/pace.min.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.1/es5/tex-mml-chtml.js","integrity":"sha256-hlC2uSQYTmPsrzGZTEQEg9PZ1a/+SV6VBCTclohf2og="}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/third-party/math/mathjax.min.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"disqusforqwerty","count":false,"i18n":{"disqus":"disqus"}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.12.1/third-party/comments/disqus.min.js"></script>

</body>
</html>
